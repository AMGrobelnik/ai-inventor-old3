<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invention Knowledge Graph</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(224 71% 4%)',
                        foreground: 'hsl(213 31% 91%)',
                        card: 'hsl(222 47% 11%)',
                        'card-foreground': 'hsl(213 31% 91%)',
                        primary: 'hsl(210 40% 98%)',
                        secondary: 'hsl(222.2 47.4% 11.2%)',
                        muted: 'hsl(223 47% 11%)',
                        'muted-foreground': 'hsl(215.4 16.3% 56.9%)',
                        accent: 'hsl(216 34% 17%)',
                        border: 'hsl(216 34% 17%)',
                        ring: 'hsl(224 76% 48%)',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        #main { width: 100vw; height: 100vh; }

        /* Clean minimal select */
        .select-clean {
            appearance: none;
            background: transparent;
            border: none;
            color: hsl(213 31% 91%);
            font-size: 13px;
            font-weight: 500;
            padding: 6px 28px 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 6px center;
            background-repeat: no-repeat;
            background-size: 16px 16px;
            white-space: nowrap;
        }
        .select-clean:hover { background-color: hsl(216 34% 17%); }
        .select-clean:focus { outline: none; background-color: hsl(216 34% 20%); }
        .select-clean option {
            background: hsl(222 47% 11%);
            color: hsl(213 31% 91%);
            padding: 8px;
        }

        .toolbar-divider { width: 1px; height: 20px; background: hsl(216 34% 20%); margin: 0 4px; }
        .icon-btn {
            display: flex; align-items: center; justify-content: center;
            width: 32px; height: 32px; border-radius: 6px;
            transition: all 0.15s;
        }
        .icon-btn:hover { background: hsl(216 34% 17%); }
        .icon-btn.active { background: hsl(224 76% 48%); color: white; }
        /* Toggle switch container */
        .toggle-switch {
            display: flex;
            background: hsl(216 34% 12%);
            border-radius: 20px;
            padding: 2px;
            border: 1px solid hsl(216 34% 20%);
        }
        .toggle-btn {
            padding: 5px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .toggle-btn.active {
            background: hsl(224 76% 48%);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .toggle-btn:not(.active) {
            color: hsl(215.4 16.3% 56.9%);
            background: transparent;
        }
        .toggle-btn:not(.active):hover {
            color: hsl(213 31% 91%);
            background: hsl(216 34% 17%);
        }

        /* Year slider - visible track */
        .year-slider {
            width: 100px;
            height: 6px;
            appearance: none;
            cursor: pointer;
            background: hsl(216 34% 22%);
            border-radius: 3px;
            border: 1px solid hsl(216 34% 30%);
        }
        .year-slider::-webkit-slider-runnable-track {
            height: 6px;
            background: linear-gradient(to right, hsl(224 76% 48% / 0.3), hsl(216 34% 28%));
            border-radius: 3px;
        }
        .year-slider::-webkit-slider-thumb {
            appearance: none;
            width: 14px;
            height: 14px;
            background: hsl(224 76% 58%);
            border: 2px solid hsl(224 76% 70%);
            border-radius: 50%;
            margin-top: -4px;
            cursor: pointer;
            box-shadow: 0 0 4px rgba(59, 130, 246, 0.5);
        }
        .year-slider::-webkit-slider-thumb:hover {
            background: hsl(224 76% 65%);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.7);
        }
        .year-slider::-moz-range-track {
            height: 6px;
            background: linear-gradient(to right, hsl(224 76% 48% / 0.3), hsl(216 34% 28%));
            border-radius: 3px;
        }
        .year-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: hsl(224 76% 58%);
            border: 2px solid hsl(224 76% 70%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 4px rgba(59, 130, 246, 0.5);
        }
        .year-slider::-moz-range-thumb:hover {
            background: hsl(224 76% 65%);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.7);
        }

        /* Legend popover */
        .legend-popover {
            position: absolute; top: 52px; left: 8px; z-index: 100;
            background: hsl(222 47% 11% / 0.95); backdrop-filter: blur(8px);
            border: 1px solid hsl(216 34% 17%); border-radius: 8px;
            padding: 12px; max-width: 280px;
            opacity: 0; visibility: hidden; transform: translateY(-8px);
            transition: all 0.2s;
        }
        .legend-popover.show { opacity: 1; visibility: visible; transform: translateY(0); }
    </style>
</head>
<body class="bg-background text-foreground overflow-hidden">
    <div id="main"></div>

    <!-- Top Toolbar -->
    <div class="absolute top-2 left-2 right-2 z-50 flex items-center gap-2 bg-card/95 backdrop-blur-sm border border-border rounded-lg px-3 py-2">
        <!-- Graph Type -->
        <select id="graph-type" class="select-clean">
            <option value="concepts">Concepts</option>
            <option value="paper_concepts">Paper to Concepts</option>
            <option value="ontology">Concept Ontology</option>
            <option value="blind_spots">Blind Spots</option>
        </select>

        <!-- Layout Toggle -->
        <div id="layout-toggle-container" class="toggle-switch" style="display: none;">
            <button id="layout-force" class="toggle-btn active">Force</button>
            <button id="layout-alt" class="toggle-btn"><span id="layout-alt-label">Circular</span></button>
        </div>

        <!-- Ontology Filter Toggle -->
        <div id="ontology-filter-container" class="toggle-switch" style="display: none;">
            <button id="filter-overlap" class="toggle-btn active">Overlap</button>
            <button id="filter-full" class="toggle-btn">Full</button>
        </div>

        <!-- Cross-Topic Gaps Toggle -->
        <div id="gaps-toggle-container" class="toggle-switch" style="display: none;">
            <button id="gaps-off" class="toggle-btn active">Shared</button>
            <button id="gaps-on" class="toggle-btn">Gaps</button>
        </div>

        <!-- Best/All Concepts Toggle (blind spots only) -->
        <div id="best-toggle-container" class="toggle-switch" style="display: none;">
            <button id="filter-best" class="toggle-btn active">Best</button>
            <button id="filter-all" class="toggle-btn">All</button>
        </div>

        <!-- Topic Filter -->
        <select id="topic-filter" class="select-clean">
            <option value="all">All Topics</option>
        </select>

        <!-- Relation Filter (semantic graph only) -->
        <select id="relation-filter" class="select-clean" style="display: none;">
            <option value="all">All Relations</option>
            <option value="uses">Uses</option>
            <option value="proposes">Proposes</option>
        </select>

        <div class="toolbar-divider"></div>

        <!-- Year Controls -->
        <div id="year-controls" class="flex items-center gap-2">
            <button id="play-button" class="icon-btn text-muted-foreground" title="Play/Pause">
                <i data-lucide="play" class="w-4 h-4"></i>
            </button>
            <span id="year-display" class="text-sm font-medium text-blue-400 min-w-[70px] text-center">All Years</span>
            <input type="range" id="year-slider" min="0" max="1" value="0" step="1"
                class="year-slider">
        </div>

        <div class="flex-1"></div>

        <!-- Stats -->
        <div class="flex items-center gap-4 text-xs text-muted-foreground">
            <span>
                Nodes <span id="node-count" class="text-blue-400 font-medium ml-1">-</span>
            </span>
            <span>
                Edges <span id="edge-count" class="text-blue-400 font-medium ml-1">-</span>
            </span>
        </div>

        <div class="toolbar-divider"></div>

        <!-- Action Buttons -->
        <button id="legend-btn" class="icon-btn text-muted-foreground" title="Legend">
            <i data-lucide="info" class="w-4 h-4"></i>
        </button>
        <button id="fullscreen-btn" class="icon-btn text-muted-foreground" title="Fullscreen">
            <i data-lucide="maximize-2" class="w-4 h-4"></i>
        </button>
    </div>

    <!-- Legend Popover -->
    <div id="legend-popover" class="legend-popover">
        <h3 id="graph-title" class="text-sm font-semibold text-blue-400 mb-2">Co-occurrence Graph</h3>
        <div id="graph-legend" class="text-xs text-muted-foreground space-y-1.5"></div>
        <p class="text-muted-foreground/60 text-xs mt-3 pt-2 border-t border-border">Drag to pan â€¢ Scroll to zoom</p>
    </div>

    <!-- Loading -->
    <div id="loading" class="absolute inset-0 flex items-center justify-center bg-background/80 z-40">
        <div class="flex items-center gap-3 text-blue-400">
            <i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i>
            <span class="text-lg font-medium">Loading...</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="graph.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Legend toggle
        const legendBtn = document.getElementById('legend-btn');
        const legendPopover = document.getElementById('legend-popover');
        let legendVisible = false;

        legendBtn.addEventListener('click', () => {
            legendVisible = !legendVisible;
            legendPopover.classList.toggle('show', legendVisible);
            legendBtn.classList.toggle('active', legendVisible);
        });

        // Close legend when clicking outside
        document.addEventListener('click', (e) => {
            if (!legendPopover.contains(e.target) && !legendBtn.contains(e.target)) {
                legendVisible = false;
                legendPopover.classList.remove('show');
                legendBtn.classList.remove('active');
            }
        });

        // Fullscreen toggle
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenBtn.classList.add('active');
            } else {
                document.exitFullscreen();
                fullscreenBtn.classList.remove('active');
            }
        });

        document.addEventListener('fullscreenchange', () => {
            const isFullscreen = !!document.fullscreenElement;
            fullscreenBtn.classList.toggle('active', isFullscreen);
            // Update icon
            const icon = fullscreenBtn.querySelector('i');
            icon.setAttribute('data-lucide', isFullscreen ? 'minimize-2' : 'maximize-2');
            lucide.createIcons();
        });
    </script>
</body>
</html>
